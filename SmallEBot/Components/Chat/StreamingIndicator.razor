@* Streaming indicator: displays streaming message bubble during active streaming, or compression indicator *@
@using SmallEBot.Components.Chat.ViewModels.Streaming

@if (IsCompressing)
{
    <div class="d-flex align-center ga-2 pa-3 mud-width-full">
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Small" />
        <MudText Typo="Typo.body2" Style="color: var(--mud-palette-text-secondary);">
            @CompressionMessage
        </MudText>
    </div>
}
else if (IsStreaming)
{
    <StreamingMessageView Items="@StreamingItems"
                          FallbackText="@FallbackText"
                          Timestamp="@Timestamp"
                          OnCancel="@OnCancel"
                          ShowWaitingForToolParams="@ShowWaitingForToolParams"
                          WaitingElapsed="@WaitingElapsed"
                          WaitingInReasoning="@WaitingInReasoning"
                          ShowToolCalls="@ShowToolCalls" />
}

@code {
    [Parameter] public bool IsStreaming { get; set; }
    [Parameter] public IReadOnlyList<StreamingDisplayItemView>? StreamingItems { get; set; }
    [Parameter] public string? FallbackText { get; set; }
    [Parameter] public DateTime Timestamp { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }
    [Parameter] public bool ShowWaitingForToolParams { get; set; }
    [Parameter] public TimeSpan WaitingElapsed { get; set; }
    [Parameter] public bool WaitingInReasoning { get; set; }
    [Parameter] public bool ShowToolCalls { get; set; } = true;

    [Parameter] public bool IsCompressing { get; set; }
    [Parameter] public string CompressionMessage { get; set; } = "Compressing context...";
}
