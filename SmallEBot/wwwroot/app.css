/* SmallEBot design tokens – editorial dark (default) */
[data-theme="editorial-dark"] {
    --seb-bg: #1a1a1d;
    --seb-surface: #252529;
    --seb-surface-elevated: #2d2d32;
    --seb-primary: #e4a853;
    --seb-primary-muted: rgba(228, 168, 83, 0.15);
    --seb-text: #e4e4e7;
    --seb-text-secondary: #a1a1aa;
    --seb-border: #3f3f46;
    --seb-chat-user: #2d2d32;
    --seb-chat-assistant: #252529;
    --seb-font-ui: 'Outfit', sans-serif;
    --seb-font-body: 'Spectral', Georgia, serif;
}

/* Fallback when data-theme not yet set (e.g. before JS) */
html:not([data-theme]) {
    --seb-bg: #1a1a1d;
    --seb-surface: #252529;
    --seb-surface-elevated: #2d2d32;
    --seb-primary: #e4a853;
    --seb-primary-muted: rgba(228, 168, 83, 0.15);
    --seb-text: #e4e4e7;
    --seb-text-secondary: #a1a1aa;
    --seb-border: #3f3f46;
    --seb-chat-user: #2d2d32;
    --seb-chat-assistant: #252529;
    --seb-font-ui: 'Outfit', sans-serif;
    --seb-font-body: 'Spectral', Georgia, serif;
}

[data-theme="paper-light"] {
    --seb-bg: #f5f0e8;
    --seb-surface: #fffef9;
    --seb-surface-elevated: #faf8f4;
    --seb-primary: #2d5016;
    --seb-primary-muted: rgba(45, 80, 22, 0.12);
    --seb-text: #1c1c1a;
    --seb-text-secondary: #57534e;
    --seb-border: #d6d3ce;
    --seb-chat-user: #e8e4dc;
    --seb-chat-assistant: #fffef9;
    --seb-font-ui: 'Outfit', sans-serif;
    --seb-font-body: 'Spectral', Georgia, serif;
}

[data-theme="terminal"] {
    --seb-bg: #0d0d0d;
    --seb-surface: #1a1a1a;
    --seb-surface-elevated: #262626;
    --seb-primary: #22c55e;
    --seb-primary-muted: rgba(34, 197, 94, 0.15);
    --seb-text: #e4e4e7;
    --seb-text-secondary: #a1a1aa;
    --seb-border: #3f3f46;
    --seb-chat-user: #262626;
    --seb-chat-assistant: #1a1a1a;
    --seb-font-ui: ui-monospace, 'Cascadia Code', monospace;
    --seb-font-body: ui-monospace, 'Cascadia Code', monospace;
}

[data-theme="dusk"] {
    --seb-bg: #1e1b2e;
    --seb-surface: #2d2842;
    --seb-surface-elevated: #36304a;
    --seb-primary: #e9a23b;
    --seb-primary-muted: rgba(233, 162, 59, 0.15);
    --seb-text: #e4e4e7;
    --seb-text-secondary: #a1a1aa;
    --seb-border: #4a4563;
    --seb-chat-user: #36304a;
    --seb-chat-assistant: #2d2842;
    --seb-font-ui: 'Outfit', sans-serif;
    --seb-font-body: 'Spectral', Georgia, serif;
}

[data-theme="mono"] {
    --seb-bg: #0f0f0f;
    --seb-surface: #1a1a1a;
    --seb-surface-elevated: #262626;
    --seb-primary: #e4e4e7;
    --seb-primary-muted: rgba(228, 228, 231, 0.12);
    --seb-text: #e4e4e7;
    --seb-text-secondary: #a1a1aa;
    --seb-border: #3f3f46;
    --seb-chat-user: #262626;
    --seb-chat-assistant: #1a1a1a;
    --seb-font-ui: ui-sans-serif, system-ui, sans-serif;
    --seb-font-body: ui-sans-serif, system-ui, sans-serif;
}

html, body {
    font-family: var(--seb-font-body);
    background: var(--seb-bg);
    color: var(--seb-text);
    height: 100%;
    overflow: hidden;
}

/* Layout: app bar and main – no page scroll, only inner chat scrolls */
.smallebot-layout {
    height: 100%;
}
/* Override MudBlazor’s default main-content padding so we control spacing in one place */
.smallebot-layout .mud-main-content {
    background: var(--seb-bg);
    height: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    padding: 0 !important;
}
.smallebot-main {
    flex: 1;
    min-height: 0;
    overflow: hidden;
}
.smallebot-appbar {
    background: var(--seb-surface) !important;
    border-bottom: 1px solid var(--seb-border);
}
.smallebot-logo {
    font-family: var(--seb-font-ui) !important;
    font-weight: 600;
    letter-spacing: 0.02em;
}
.smallebot-username {
    color: var(--seb-text-secondary);
    font-family: var(--seb-font-ui);
}

/* Chat page: minimal top gap, minimal bottom so input bar sits near bottom */
.smallebot-chat-page {
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 3.5rem 1.5rem 0.2rem 1.5rem;
    min-height: 0;
}
.smallebot-chat-outer {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    width: 100%;
}

/* Chat area: paper fills space, only this region scrolls; minimal bottom padding so input is near bottom */
.smallebot-chat-paper {
    background: var(--seb-surface) !important;
    border-radius: 12px;
    border: 1px solid var(--seb-border);
    padding: 1.5rem 1.5rem 0.2rem 1.5rem !important;
    box-shadow: none;
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
}
.smallebot-chat-scroll {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 2.5rem 6px 0 0;
    scroll-behavior: smooth;
}
.smallebot-chat-scroll::-webkit-scrollbar { width: 8px; }
.smallebot-chat-scroll::-webkit-scrollbar-track { background: transparent; }
.smallebot-chat-scroll::-webkit-scrollbar-thumb { background: var(--seb-border); border-radius: 4px; }

/* Message bubbles – stagger fade-in */
.smallebot-bubble {
    animation: seb-fade-in 0.35s ease-out both;
}
.smallebot-bubble:nth-child(1) { animation-delay: 0.02s; }
.smallebot-bubble:nth-child(2) { animation-delay: 0.06s; }
.smallebot-bubble:nth-child(3) { animation-delay: 0.1s; }
.smallebot-bubble:nth-child(4) { animation-delay: 0.14s; }
.smallebot-bubble:nth-child(5) { animation-delay: 0.18s; }
.smallebot-bubble:nth-child(n+6) { animation-delay: 0.22s; }
@keyframes seb-fade-in {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Override MudChat bubble look for dark theme */
.smallebot-chat-paper .mud-chat-bubble {
    background: var(--seb-chat-assistant) !important;
    border: 1px solid var(--seb-border);
    border-radius: 12px;
}
.smallebot-chat-paper .mud-chat-position-end .mud-chat-bubble {
    background: var(--seb-chat-user) !important;
    border-color: var(--seb-border);
}

/* Error reply styling when assistant message starts with "Error: " */
.smallebot-assistant-error .mud-chat-bubble {
    border-color: #dc2626 !important;
    background: rgba(220, 38, 38, 0.12) !important;
}
.smallebot-assistant-error .markdown-body {
    color: #f87171;
}
.smallebot-chat-paper .mud-chat-bubble .mud-chat-bubble-message {
    font-family: var(--seb-font-body);
}
.smallebot-reasoning-step {
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--seb-border);
}
.smallebot-reasoning-step:last-child { border-bottom: none; }
.smallebot-reasoning-label {
    color: var(--seb-primary);
}
.smallebot-reasoning-body {
    font-size: 0.9em;
    color: var(--seb-text-secondary);
}

.smallebot-chat-paper .mud-chat-bubble .mud-typography-caption {
    color: var(--seb-text-secondary);
    font-family: var(--seb-font-ui);
    margin-bottom: 0.5rem;
}
/* Spacing between content blocks inside a bubble (text, tool views, etc.) */
.smallebot-chat-paper .mud-chat-bubble .mud-chat-bubble-message > * + * {
    margin-top: 0.75rem;
}

/* Sidebar */
.smallebot-drawer {
    background: var(--seb-surface) !important;
    border-right: 1px solid var(--seb-border);
}
.smallebot-drawer .mud-drawer-header {
    border-bottom: 1px solid var(--seb-border);
}
.smallebot-drawer .mud-list-item {
    font-family: var(--seb-font-ui);
}
.smallebot-drawer .mud-list-item:hover {
    background: var(--seb-primary-muted);
}
.smallebot-empty-state {
    font-family: var(--seb-font-body);
    color: var(--seb-text-secondary);
    text-align: center;
    padding: 3rem 1.5rem;
}

a, .btn-link {
    color: #006bb7;
}

.btn-primary {
    color: #fff;
    background-color: #1b6ec2;
    border-color: #1861ac;
}

.btn:focus, .btn:active:focus, .btn-link.nav-link:focus, .form-control:focus, .form-check-input:focus {
  box-shadow: 0 0 0 0.1rem white, 0 0 0 0.25rem #258cfb;
}

.content {
    padding-top: 1.1rem;
}

h1:focus {
    outline: none;
}

.valid.modified:not([type=checkbox]) {
    outline: 1px solid #26b050;
}

.invalid {
    outline: 1px solid #e50000;
}

.validation-message {
    color: #e50000;
}

.blazor-error-boundary {
    background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTYiIGhlaWdodD0iNDkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIG92ZXJmbG93PSJoaWRkZW4iPjxkZWZzPjxjbGlwUGF0aCBpZD0iY2xpcDAiPjxyZWN0IHg9IjIzNSIgeT0iNTEiIHdpZHRoPSI1NiIgaGVpZ2h0PSI0OSIvPjwvY2xpcFBhdGg+PC9kZWZzPjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMCkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMzUgLTUxKSI+PHBhdGggZD0iTTI2My41MDYgNTFDMjY0LjcxNyA1MSAyNjUuODEzIDUxLjQ4MzcgMjY2LjYwNiA1Mi4yNjU4TDI2Ny4wNTIgNTIuNzk4NyAyNjcuNTM5IDUzLjYyODMgMjkwLjE4NSA5Mi4xODMxIDI5MC41NDUgOTIuNzk1IDI5MC42NTYgOTIuOTk2QzI5MC44NzcgOTMuNTEzIDI5MSA5NC4wODE1IDI5MSA5NC42NzgyIDI5MSA5Ny4wNjUxIDI4OS4wMzggOTkgMjg2LjYxNyA5OUwyNDAuMzgzIDk5QzIzNy45NjMgOTkgMjM2IDk3LjA2NTEgMjM2IDk0LjY3ODIgMjM2IDk0LjM3OTkgMjM2LjAzMSA5NC4wODg2IDIzNi4wODkgOTMuODA3MkwyMzYuMzM4IDkzLjAxNjIgMjM2Ljg1OCA5Mi4xMzE0IDI1OS40NzMgNTMuNjI5NCAyNTkuOTYxIDUyLjc5ODUgMjYwLjQwNyA1Mi4yNjU4QzI2MS4yIDUxLjQ4MzcgMjYyLjI5NiA1MSAyNjMuNTA2IDUxWk0yNjMuNTg2IDY2LjAxODNDMjYwLjczNyA2Ni4wMTgzIDI1OS4zMTMgNjcuMTI0NSAyNTkuMzEzIDY5LjMzNyAyNTkuMzEzIDY5LjYxMDIgMjU5LjMzMiA2OS44NjA4IDI1OS4zNzEgNzAuMDg4N0wyNjEuNzk1IDg0LjAxNjEgMjY1LjM4IDg0LjAxNjEgMjY3LjgyMSA2OS43NDc1QzI2Ny44NiA2OS43MzA5IDI2Ny44NzkgNjkuNTg3NyAyNjcuODc5IDY5LjMxNzkgMjY3Ljg3OSA2Ny4xMTgyIDI2Ni40NDggNjYuMDE4MyAyNjMuNTg2IDY2LjAxODNaTTI2My41NzYgODYuMDU0N0MyNjEuMDQ5IDg2LjA1NDcgMjU5Ljc4NiA4Ny4zMDA1IDI1OS43ODYgODkuNzkyMSAyNTkuNzg2IDkyLjI4MzcgMjYxLjA0OSA5My41Mjk1IDI2My41NzYgOTMuNTI5NSAyNjYuMTE2IDkzLjUyOTUgMjY3LjM4NyA5Mi4yODM3IDI2Ny4zODcgODkuNzkyMSAyNjcuMzg3IDg3LjMwMDUgMjY2LjExNiA4Ni4wNTQ3IDI2My41NzYgODYuMDU0N1oiIGZpbGw9IiNGRkU1MDAiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvZz48L3N2Zz4=) no-repeat 1rem/1.8rem, #b32121;
    padding: 1rem 1rem 1rem 3.7rem;
    color: white;
}

    .blazor-error-boundary::after {
        content: "An error has occurred."
    }

.darker-border-checkbox.form-check-input {
    border-color: #929292;
}

.form-floating > .form-control-plaintext::placeholder, .form-floating > .form-control::placeholder {
    color: var(--bs-secondary-color);
    text-align: end;
}

.form-floating > .form-control-plaintext:focus::placeholder, .form-floating > .form-control:focus::placeholder {
    text-align: start;
}

/* Rendered Markdown (Markdig) – dark editorial */
.markdown-body {
    font-family: var(--seb-font-body);
    font-size: 1rem;
    line-height: 1.65;
    word-wrap: break-word;
    color: var(--seb-text);
}
.markdown-body > :first-child { margin-top: 0 !important; }
.markdown-body > :last-child { margin-bottom: 0 !important; }
.markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {
    margin-top: 1em;
    margin-bottom: 0.5em;
    font-weight: 600;
    line-height: 1.25;
    font-family: var(--seb-font-ui);
    color: var(--seb-text);
}
.markdown-body h1 { font-size: 1.5em; }
.markdown-body h2 { font-size: 1.3em; border-bottom: 1px solid var(--seb-border); padding-bottom: 0.2em; }
.markdown-body h3 { font-size: 1.15em; }
.markdown-body p { margin: 0.5em 0; }
.markdown-body ul, .markdown-body ol { margin: 0.5em 0; padding-left: 1.5em; }
.markdown-body li + li { margin-top: 0.2em; }
.markdown-body blockquote {
    margin: 0.5em 0;
    padding: 0 1em;
    border-left: 4px solid var(--seb-primary);
    color: var(--seb-text-secondary);
}
.markdown-body code {
    padding: 0.15em 0.4em;
    font-size: 0.9em;
    background: var(--seb-primary-muted);
    border-radius: 4px;
    color: var(--seb-primary);
}
.markdown-body pre {
    margin: 0.5em 0;
    padding: 0.8em 1em;
    overflow: auto;
    font-size: 0.9em;
    line-height: 1.45;
    background: var(--seb-bg);
    border: 1px solid var(--seb-border);
    border-radius: 8px;
}
.markdown-body pre code { padding: 0; background: none; color: var(--seb-text); }
.markdown-body table {
    border-collapse: collapse;
    width: 100%;
    margin: 0.5em 0;
    display: block;
    overflow-x: auto;
}
.markdown-body th, .markdown-body td {
    border: 1px solid var(--seb-border);
    padding: 0.4em 0.6em;
    text-align: left;
}
.markdown-body th { font-weight: 600; background: var(--seb-surface-elevated); font-family: var(--seb-font-ui); }
.markdown-body tr:nth-child(even) { background: rgba(255,255,255,0.02); }
.markdown-body a { color: var(--seb-primary); text-decoration: none; }
.markdown-body a:hover { text-decoration: underline; }
.markdown-body hr { margin: 1em 0; border: none; border-top: 1px solid var(--seb-border); }
.markdown-body strong { font-weight: 600; }
.markdown-body em { font-style: italic; }
.markdown-body input[type="checkbox"] { margin-right: 0.4em; vertical-align: middle; }
.markdown-body .task-list-item { list-style-type: none; }
.markdown-body .task-list-item { padding-left: 0; margin-left: -1.2em; }

/* Skill content view dialog – scrollable body */
.view-skill-content-scroll {
    max-height: 60vh;
    overflow-y: auto;
    padding-inline-end: 4px;
}
.view-skill-content-scroll::-webkit-scrollbar { width: 8px; }
.view-skill-content-scroll::-webkit-scrollbar-track { background: transparent; }
.view-skill-content-scroll::-webkit-scrollbar-thumb { background: var(--seb-border); border-radius: 4px; }

/* Workspace drawer */
.workspace-drawer {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--seb-surface);
}
.workspace-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    border-bottom: 1px solid var(--seb-border);
}
.workspace-drawer-toolbar {
    display: flex;
    gap: 4px;
    padding: 4px 8px;
    border-bottom: 1px solid var(--seb-border);
}
.workspace-drawer-tree {
    flex: 0 1 auto;
    max-height: 50%;
    overflow-y: auto;
    padding: 8px;
}
.workspace-drawer-viewer {
    flex: 1 1 0;
    min-height: 80px;
    overflow: auto;
    border-top: 1px solid var(--seb-border);
}
.workspace-viewer-pre {
    margin: 0;
    padding: 8px 12px;
    font-size: 12px;
    white-space: pre-wrap;
    word-break: break-all;
    color: var(--seb-text);
    font-family: ui-monospace, monospace;
}
.workspace-tree-root { padding-left: 0; }
.workspace-tree-folder { margin-bottom: 2px; }
.workspace-tree-children { padding-left: 16px; }
.workspace-tree-row {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 2px 4px;
    cursor: pointer;
    border-radius: 4px;
}
.workspace-tree-row:hover { background: var(--seb-primary-muted); }
.workspace-tree-file .workspace-tree-icon-placeholder { opacity: 0.7; }
.workspace-tree-file-actions {
    display: flex;
    align-items: center;
    gap: 0;
    margin-left: auto;
}

/* Tool call view phases */
.tool-call-view {
    margin-bottom: 0.5rem;
}
.tool-call-view:last-child {
    margin-bottom: 0;
}
.tool-call-outer {
    display: flex;
    justify-content: center;
    width: 100%;
}
.tool-call-outer .tool-call-view {
    width: 100%;
    max-width: 42em;
}
.tool-call-header-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
}
.tool-call-header-left {
    display: flex;
    align-items: center;
    gap: 8px;
}
.tool-call-header-center {
    flex: 1;
    align-self: stretch;
    display: flex;
    justify-content: center;
    align-items: center;
}
.tool-call-view .tool-call-header-center .tool-call-status-text,
.tool-call-view .waiting-tool-params-center .tool-call-status-text {
    margin: 0;
    line-height: 1;
    display: inline-flex;
    align-items: center;
}
.tool-call-header-right {
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 2.5rem;
}
.waiting-tool-params-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    min-height: 2em;
    width: 100%;
}
.waiting-tool-params-center {
    flex: 1;
    align-self: stretch;
    display: flex;
    justify-content: center;
    align-items: center;
}
.waiting-tool-params-time {
    margin: 0;
    line-height: 1;
    color: var(--seb-text-secondary);
}
.waiting-tool-params-right-placeholder {
    width: 2.5rem;
    min-width: 2.5rem;
    flex-shrink: 0;
}
.waiting-tool-params-danmaku {
    padding: 0 12px 10px;
    padding-top: 2px;
}
.tool-call-paper { border-left: 3px solid var(--seb-border); }
.tool-call-paper-active { border-left-color: var(--seb-primary); }
.tool-call-paper-done { border-left-color: var(--seb-success, #2e7d32); }
.tool-call-paper-error { border-left-color: var(--seb-error, #c62828); }
.tool-call-paper-cancelled { border-left-color: var(--seb-warning, #ed6c02); }
.tool-call-details {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}
.tool-call-pre {
    margin: 0.25rem 0 0;
    padding: 10px 12px;
    font-size: 12px;
    line-height: 1.5;
    white-space: pre-wrap;
    word-break: break-all;
    background: var(--seb-surface-variant, rgba(0,0,0,0.04));
    border-radius: 6px;
    font-family: ui-monospace, monospace;
}

/* Main layout with optional right workspace drawer */
.smallebot-main-with-drawer {
    display: flex;
    width: 100%;
    height: 100%;
    position: relative;
}
.smallebot-main-body {
    flex: 1;
    min-width: 0;
    height: 100%;
}
.smallebot-workspace-drawer-panel {
    width: 360px;
    min-width: 360px;
    height: 100%;
    overflow: hidden;
    border-left: 1px solid var(--seb-border);
    background: var(--seb-surface);
}

/* Task list drawer */
.task-list-drawer {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--seb-surface);
}
.task-list-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    border-bottom: 1px solid var(--seb-border);
}
.task-list-drawer-title {
    display: flex;
    align-items: center;
    gap: 8px;
}
.task-list-drawer-icon {
    color: var(--seb-primary);
}
.task-list-drawer-body {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
}
.task-list-items {
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.task-list-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 8px 12px;
    border-radius: 4px;
}
.task-list-item:hover {
    background: var(--seb-primary-muted);
}
.task-list-item-icon {
    flex-shrink: 0;
    margin-top: 2px;
}
.task-list-item-content {
    flex: 1;
    min-width: 0;
}
.task-list-item-done {
    text-decoration: line-through;
    color: var(--seb-text-secondary);
}
.task-list-item-desc {
    margin-top: 2px;
}
.task-list-drawer-actions {
    padding: 8px 12px;
    border-top: 1px solid var(--seb-border);
}